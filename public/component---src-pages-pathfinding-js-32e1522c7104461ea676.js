(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"6IsF":function(A,E,e){},Jedo:function(A){A.exports=JSON.parse('{"data":{"placeholderImage":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAKABQDAREAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAABQAECf/EABkBAQACAwAAAAAAAAAAAAAAAAQAAQIDBf/aAAwDAQACEAMQAAAB25wFUs7VKfN0FWapJ//EABsQAAIBBQAAAAAAAAAAAAAAAAEEAwAQERQy/9oACAEBAAEFApFJsaTdBaQBXi3/xAAmEQABAgQEBwEAAAAAAAAAAAABAxEAAgQSBSFBURATFCJDkcLT/9oACAEDAQE/AV58SBel6SW4lwoFmEuVoFqrkvqXjm49vhvqq/aAaxu6enu1aVZn18m8L5LKAZC75HH/xAApEQABAgQBDQEAAAAAAAAAAAABAgQAAxEhMgUQExQVNEFCUWSRocHU/9oACAECAQE/AQyYzLOFOVqHNRpVSuJVVvTphAjZuSO78MvyxqrMWGnoLDd/kkD1DAktJBJJJQak3ONef//EACYQAAEBBAoDAAAAAAAAAAAAAAECAAMRgRATISIxM0FScZGx0tP/2gAIAQEABj8CSHajZqqpUTyQiEZBsxPTv5MLwwGz1aSPFP8A/8QAHhABAAEEAgMAAAAAAAAAAAAAAREAITFBEFGB0fD/2gAIAQEAAT8ha1SZcuLKC7IdfY+lHTIA43gnyavTvNvLn//aAAwDAQACAAMAAAAQ0/A//8QAHBEBAQACAgMAAAAAAAAAAAAAAREhMQChEEFx/9oACAEDAQE/EE85TWCgIKVSnW/F3bRIsOPdO+JCVAkdQYFMySqyVt4QYAAAADSBgPnn/8QAHhEBAQEAAgEFAAAAAAAAAAAAAREhAEEQMVFhcfD/2gAIAQIBAT8QCNOpNixsVMFaaQnPk6/vF+sOx4Dj7A9BhdKBYC2QhxGQCFFsqqq9rvn/xAAbEAEBAQEAAwEAAAAAAAAAAAABESExABBRQf/aAAgBAQABPxAubShyBSapFwR8rRwuN7Gdw0/VEeeXn4exJQgguAFgHBKCqotX2XXr36+//9k=","aspectRatio":2.0779220779220777,"src":"/static/2a924a9735b2c908a4c5ed0fb92933b7/1bd3a/profile-pathfinding-threaded.jpg","srcSet":"/static/2a924a9735b2c908a4c5ed0fb92933b7/836e2/profile-pathfinding-threaded.jpg 480w,\\n/static/2a924a9735b2c908a4c5ed0fb92933b7/b1cc5/profile-pathfinding-threaded.jpg 960w,\\n/static/2a924a9735b2c908a4c5ed0fb92933b7/1bd3a/profile-pathfinding-threaded.jpg 1919w","sizes":"(max-width: 1919px) 100vw, 1919px"}}}}}')},NOi8:function(A,E,e){"use strict";e.r(E);var a=e("q1tI"),B=e.n(a),Q=e("Wbzz"),t=(e("fMzE"),e("Bl7J")),n=e("vrFN"),l=(e("6IsF"),e("c1AZ")),i=e("9eSz"),c=e.n(i),r=function(A){A.src;var E=l.data;return B.a.createElement(c.a,{fluid:E.placeholderImage.childImageSharp.fluid})},s=e("Jedo"),p=function(A){A.src;var E=s.data;return B.a.createElement(c.a,{fluid:E.placeholderImage.childImageSharp.fluid})},g=e("prZX"),o=function(A){A.src;var E=g.data;return B.a.createElement(c.a,{fluid:E.placeholderImage.childImageSharp.fluid})},f=e("P6vx"),m=function(A){A.src;var E=f.data;return B.a.createElement(c.a,{fluid:E.placeholderImage.childImageSharp.fluid})};E.default=function(){return B.a.createElement(t.a,{className:"pathfinding-page"},B.a.createElement(n.a,{title:"О поиске пути"}),B.a.createElement("div",null,B.a.createElement("header",{className:"lead"},B.a.createElement("h1",null,"Поиск пути"),B.a.createElement("summary",null,"Это история о том, что свой путь можно найти несколькими способами.")),B.a.createElement("iframe",{className:"pathfinding-demo",frameBorder:"0",src:"/pathfinding-demo/index.html"})),B.a.createElement("article",null,B.a.createElement("p",{className:"letter"},"Когда я создал ",B.a.createElement(Q.Link,{to:"/forest"},"сцену с лесом")," и добавил туда персонажа (которого, кстати, взял на ",B.a.createElement(Q.Link,{to:"https://www.mixamo.com/#/"},"Mixamo"),"), я подумал, что этот персонаж не может просто стоять на карте, как истукан, а должен уметь по ней передвигаться. Но не просто из точки А в точку Б, а с учетом препятствий. Раз уж наш пока что лирический герой находится в лесу, то должен уметь обходить деревья. Для меня это совершенно новый опыт и, возможно, люди, которые больше меня подкованы в теме разработки игр и алгоритмах, найдут этот текст дилетантским, но мне было интересно разбираться в том, как работает один из молотов, кующих разработчика, А*."),B.a.createElement("h2",null,"A*"),B.a.createElement("p",null,"Если представить поверхность, по которой нужно перемещаться персонажу, сеткой, то поиск пути от одной клетки до другой - это задача поиска в графе. Один из самых оптимальных способов это сделать - применить алгоритм, которому уже 62 года. Представим, что у каждой клетки есть некоторая проходимость - чем сложнее по ней передвигаться, тем выше стоимость передвижения. Некоторые клетки (те, на которых есть деревья), вообще непроходмы. Задача А* - найти такой путь, который будет иметь минимальную стоимость, то есть будет самым быстрым. Для этого для каждой клетки дополнительно еще используется эвристическая оценка, которая показывает, насколько перспективным решением будет пойти в ту или иную сторону."),B.a.createElement("p",null,"Раз уж так получилось, что я занимаюсь фронтендом и мне интересны возможности веб-платформы, самым логичным шагом было начать с javascript-имплементации. Существует отличная библиотека ",B.a.createElement(Q.Link,{to:"http://qiao.github.io/PathFinding.js/visual/"},"PathFinding.js"),", в которой собран десяток различных вариантов этого алгоритма и несколько видов эвристик. По ссылке можно посмотреть на статистику: сколько проходит итераций поиска, сколько он занимает времени. Самым оптимальным, на мой взгляд, был двунаправленный Best First Search с эвристикой Octile. Дополнительно он может свернуть путь до небольшого количества ключевых точек, определяющих, где находятся повороты. ",B.a.createElement(Q.Link,{to:"https://github.com/johnSamilin/forest/blob/pathfinding/src/utils/pathfinding/js.ts"},"Ссылка на код")),B.a.createElement("p",null,B.a.createElement("strong",null,"Профиль производительности js-версии"),B.a.createElement(r,null)),B.a.createElement("h2",null,"А можно мощнее?"),B.a.createElement("p",null,"Javascript - штука однопоточная, и если иметь дело с большой или запутанной картой, вычисления могут повлиять на отзывчивость интерфейса. Браузер и без того занят тем, что выполняет кучу работы по визуализации сцены каждые 16 миллисекунд, и правильным решением было бы ему помочь. Например, вынеся задачу поиска пути в отдельный поток, в воркер. По идее, это должно освободить основной поток для выполнения и планирования более важной работы. ",B.a.createElement(Q.Link,{to:"https://github.com/johnSamilin/forest/blob/pathfinding/src/utils/pathfinding/threaded.ts"},"Ссылка")," на тот же самый код, что и в предыдущем примере, но уже перенесенный внурть ",B.a.createElement("em",null,"работника")," (",B.a.createElement(Q.Link,{to:"https://github.com/johnSamilin/forest/blob/pathfinding/src/utils/pathfinding/pathfinding.worker.ts"},"Github"),")."),B.a.createElement("p",null,B.a.createElement("strong",null,"Профиль производительности worker-версии"),B.a.createElement(p,null)),B.a.createElement("h2",null,"А еще мощнее?"),B.a.createElement("p",null,"JS-версия, я уверен, использует все ",B.a.createElement(Q.Link,{to:"https://blog.sessionstack.com/how-javascript-works-inside-the-v8-engine-5-tips-on-how-to-write-optimized-code-ac089e62b12e"},"возможности движка по оптимизации"),", как например, hidden classes и кеширование, и при использовании TypeScript можно быть в той или иной степени уверенным в том, что параметры, передающиеся в методы ",B.a.createElement("strong",null,"PathFinding.js"),", будут всегда одного и того же типа. Это, в свою очередь, не будет приводить к их деоптимизации. Но еще интересней попробовать запустить этот процесс в WebAssembly с ",B.a.createElement("em",null,"near-native")," скоростью. С точки зрения веб-технологий это еще более любопытно, потому что, несмотря на 10 лет своего существования, WebAssembly не используется так уж широко."),B.a.createElement("p",null,"WebAssembly можно скомпилировать из десятка языков, включая C++, Go и Rust. Так как я не умею писать ни на одном из них, то можно просто найти готовое решение и скомпилировать его под свои нужды. Я выбрал Go, потому что... не знаю, просто попробовать. Благодаря отличному разбору ",B.a.createElement(Q.Link,{to:"https://www.aaron-powell.com/posts/2019-02-05-golang-wasm-2-writing-go/"},"Aaron Powell"),", все оказалось не так уж и сложно и заняло буквально один день. Штука в том (и об этом есть упоминание в статье), что Wasm, скомпилированный из Go, ведет себя как отдельная подпрограмма. В ней можно использовать состояние и не инициализировать граф с препятствиями при каждом вызове. Учитывая, что в конкретно этой моей WebGL-сцене поиск пути выполняется при движении мыши над плоскостью, это может сэкономить некоторое количество ресурсов. Хотя этот же факт может привести к нежелательным последствиям:",B.a.createElement("ul",null,B.a.createElement("li",null,"исключение, выброшенное внутри Wasm-модуля, означает, что поток, который не дает Go-скрипту завершиться, закрывается и повторная попытка вызвать какие-то из его функций будет неудачной;"),B.a.createElement("li",null,"Go не экспортирует никаких функций, он регистрирует обработчики в глобальной области видимости. Это может привести к конфликту имен;"),B.a.createElement("li",null,"то, что через все ту же глобальную область видимости он может манипулировать DOM, на мой взгляд, делает Go потенциально небезопасной штукой.")),B.a.createElement(Q.Link,{to:"https://github.com/johnSamilin/go-pathfinding"},"Go-имплементация")),B.a.createElement("p",null,B.a.createElement("strong",null,"Профиль производительности go-версии"),B.a.createElement(o,null)),B.a.createElement("h2",null,"Еще!"),B.a.createElement("p",null,"Чтобы ",B.a.createElement("del",null,"совсем упороться")," не пренебрегать возможностями Wasm по управлению памятью, я решил пойти на эксперимент и написать рализацию А* самому на AssmeblyScript. Это версия TypeScript с чуть более строгими ограничениями и ",B.a.createElement(Q.Link,{to:"https://www.assemblyscript.org/stdlib/map.html#map"},"разницей в поведении базовых типов")," (к примеру, ",B.a.createElement("em",null,"Map.keys()")," возвращает не итератор, а массив ключей). В случае чего, AssmeblyScript-код можно довольно быстро преобразовать в TypeScript. Увидеть результат можно ",B.a.createElement(Q.Link,{to:"https://github.com/johnSamilin/assemblyscript-pathfinding"},"тут"),"."),B.a.createElement("p",null,B.a.createElement("strong",null,"Профиль производительности AssembyScript-версии"),B.a.createElement(m,null)),B.a.createElement("h2",null,"Как теперь с этим жить?"),B.a.createElement("p",null,"Я надеялся, что простая миграция миграция кода с уровня браузера на уровен WebAssembly даст прирость производительности и избавит от головной боли по оптимизации. Но, как видно из скриншотов профилировщика, большой разницы нет. Wasm-версии работают даже немного хуже в периоды интенсивной деятельности. FPS снижается иногда до 1-2 кадров в секунду, и в это время сильно нагружен GPU. Эксперимент завершился, самый правильный выбор - полагаться на браузерный движок.")))}},P6vx:function(A){A.exports=JSON.parse('{"data":{"placeholderImage":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAKABQDAREAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAUEBgn/xAAXAQADAQAAAAAAAAAAAAAAAAAAAwQB/9oADAMBAAIQAxAAAAHbVUUYS32qzptZVLA//8QAHBAAAQMFAAAAAAAAAAAAAAAABAECAwAQERIy/9oACAEBAAEFApAp1pwBuEDfqNxb/8QAKBEAAgEBBgQHAAAAAAAAAAAAARECAwAEBRIhQRATFCIkMTNRYXGT/9oACAEDAQE/Aas8TzeGNxFMsqpTrsbADLUD03O9uZjmuuGfHZevP9Pe0esIBnK75ijJQmsy7ky02nat6s/vj//EACYRAAECBAMJAAAAAAAAAAAAAAEEEQACAyEUMZEFEBU0UVJzwdT/2gAIAQIBAT8BwCCpetOsNS7zApnmOZMzpzfSOG7J7l2qP5ow6IWlFZhYOaTsLB2ptl0tCLlKHj9nf//EACQQAAECBQIHAAAAAAAAAAAAAAECEQADEhMhMVEQI0FCcZKy/9oACAEBAAY/AhbmFhvaUT5NqFNOSFEGl0y9Ww/IPWE1LDhKQWbUDPZvHr8jj//EABsQAQEAAwADAAAAAAAAAAAAAAERACExEEFx/9oACAEBAAE/IdkhSnlRoFnshkEYCjGxRq0WnB1iBQ0wHYEJGnh8OZ08v//aAAwDAQACAAMAAAAQzlA//8QAHREBAQACAQUAAAAAAAAAAAAAAREhUQAQMWGB8P/aAAgBAwEBPxArUim9lImBtGjMGM4oFGpjBJgZ0euKUNCbByu2LJdvw+Dr/8QAHBEBAQACAgMAAAAAAAAAAAAAAREhMVFhABBB/9oACAECAQE/EFTdoyhhMtAgditXc8S2l5M9dTV35isHXqANQWCtAQMlcqKu3nfvv//EABkQAQEBAQEBAAAAAAAAAAAAAAERITFBEP/aAAgBAQABPxBcuVbIVG4bWEh6K5JJThhegTRgMJX1NAmcZCiAAAggAukNZCvvX7//2Q==","aspectRatio":2.0425531914893615,"src":"/static/2b14e8aaf8a898682cabf90ef258f1a6/097fa/profile-pathfinding-as.jpg","srcSet":"/static/2b14e8aaf8a898682cabf90ef258f1a6/836e2/profile-pathfinding-as.jpg 480w,\\n/static/2b14e8aaf8a898682cabf90ef258f1a6/b1cc5/profile-pathfinding-as.jpg 960w,\\n/static/2b14e8aaf8a898682cabf90ef258f1a6/097fa/profile-pathfinding-as.jpg 1920w","sizes":"(max-width: 1920px) 100vw, 1920px"}}}}}')},c1AZ:function(A){A.exports=JSON.parse('{"data":{"placeholderImage":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAKABQDAREAAhEBAxEB/8QAFwABAAMAAAAAAAAAAAAAAAAABQADCf/EABcBAQEBAQAAAAAAAAAAAAAAAAQAAwL/2gAMAwEAAhADEAAAAdssgV2bPanzOSXlK//EABsQAAEEAwAAAAAAAAAAAAAAAAQAAQIUEBEy/9oACAEBAAEFAphk7pFqrJ0Nxj//xAAoEQABAgMECwAAAAAAAAAAAAABAgMABUEEERMUEBIhM1FlcoGRwdP/2gAIAQMBAT8BdcmocOXMvwiSQHE2rWSKC9Lwv2V4xjTzlni2feBm6qY7JX7XD++c6tP/xAAsEQABAQQEDwAAAAAAAAAAAAABAgADBBMFERQxEBUhIjRCU2FzgZGkssHU/9oACAECAQE/AbBR68r57Gl5rKFhzjeVEKhK6z03NiyidrHdh8TSIMXTecn06DQWiuOGPJWH/8QAJRAAAQIADwAAAAAAAAAAAAAAAQADEBMhIiMyM2KBkZKistLT/9oACAEBAAY/AqN2beiCcSG5SrUZN+KrDb1WniIf/8QAHBABAAEFAQEAAAAAAAAAAAAAAREAITFBYRBR/9oACAEBAAE/IXZn1JmlkQiUjkVMVy2nAFkU389H/9oADAMBAAIAAwAAABCraT//xAAdEQEBAAIDAAMAAAAAAAAAAAABESExAEFREHGB/9oACAEDAQE/EH2REUKININKpzMcc9KpDDsq+yYPv3iA51rg5BZl3fyba80ehgdABA8Dz5//xAAbEQEBAAMBAQEAAAAAAAAAAAABESExQQAQgf/aAAgBAgEBPxC5kmhnkAEumKTDzo5Lm4v6Lm90+ABgMdsYNCQOHYBAauqqyuVWivV+/wD/xAAcEAEBAAIDAQEAAAAAAAAAAAABESExAEFRkWH/2gAIAQEAAT8QMMnW51WUgF2BeYStmsYvYgxnvJ+ZUzqCTYHgM27Lo0HGzTUFuUJC7Z1ddcr6/XlfX68//9k=","aspectRatio":2.0253164556962027,"src":"/static/46b661737fc0fce7dfa7f496608debfe/e1744/profile-pathfinding-js.jpg","srcSet":"/static/46b661737fc0fce7dfa7f496608debfe/836e2/profile-pathfinding-js.jpg 480w,\\n/static/46b661737fc0fce7dfa7f496608debfe/b1cc5/profile-pathfinding-js.jpg 960w,\\n/static/46b661737fc0fce7dfa7f496608debfe/e1744/profile-pathfinding-js.jpg 1918w","sizes":"(max-width: 1918px) 100vw, 1918px"}}}}}')},prZX:function(A){A.exports=JSON.parse('{"data":{"placeholderImage":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAKABQDAREAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAUDBgn/xAAYAQADAQEAAAAAAAAAAAAAAAAAAwQBAv/aAAwDAQACEAMQAAAB2zXBGLa9U2Oe5jSs0//EABsQAAIBBQAAAAAAAAAAAAAAAAIEAQAQEhQy/9oACAEBAAEFAjTZmdJqhUPFbi3/xAArEQABAQQFDQAAAAAAAAAAAAABAgADBBMFERIxMhAUFSEzYWVxcoGRwdP/2gAIAQMBAT8BePaWCzm+j5V4mCLta78D4DvU02nOG+Iz7MgxpSC9MPMOOWHlivdbWVVcyz3ar6vQy//EACsRAAEBBQQKAwAAAAAAAAAAAAECAAMEEiEFEzFBEBEUFSI0U3FzkaTB1P/aAAgBAgEBPwEwFnPKvXkbPnLsPszwqqnE1A15Nu2yupHfA/GwhYJHCi/KU0BVczHvK6Sn0A0Fyjjx/ZYYaP/EACYQAAEBBAoDAAAAAAAAAAAAAAECAAMSkhAREyEiMTIzQbGistP/2gAIAQEABj8CEDzCAM7E1+HLbqZXfxZMagVAX6R0kdNL6in/xAAbEAEAAgIDAAAAAAAAAAAAAAABETEQISBBUf/aAAgBAQABPyGosJa6WoxbKATsDHCNwBQyMrQe/HAH/9oADAMBAAIAAwAAABDV6T//xAAcEQEAAgIDAQAAAAAAAAAAAAABESExQQAgUWH/2gAIAQMBAT8QJLDiSSiyBgElyqzzD5qtchFYym35wqoBA6QfLKmY30o//8QAHREBAAIDAAMBAAAAAAAAAAAAARExACFBEGGBsf/aAAgBAgEBPxDiggQCjKSBJAQtAgwd5FblPB27UIGADcZZc7ZK1vWJVVVCqyrert+5R9/Xx//EABsQAQEAAwEBAQAAAAAAAAAAAAERACFBMVGR/9oACAEBAAE/EGclhJ0K2SIIIKmVm7W/QaQ8c17FqPcnqEu0TKqp1ohzE23aU9ZOvZzK/X9cr9f1z//Z","aspectRatio":2.0338983050847457,"src":"/static/45646f1433f95215a7dfd5af21a6a540/097fa/profile-pathfinding-go.jpg","srcSet":"/static/45646f1433f95215a7dfd5af21a6a540/836e2/profile-pathfinding-go.jpg 480w,\\n/static/45646f1433f95215a7dfd5af21a6a540/b1cc5/profile-pathfinding-go.jpg 960w,\\n/static/45646f1433f95215a7dfd5af21a6a540/097fa/profile-pathfinding-go.jpg 1920w","sizes":"(max-width: 1920px) 100vw, 1920px"}}}}}')}}]);
//# sourceMappingURL=component---src-pages-pathfinding-js-32e1522c7104461ea676.js.map