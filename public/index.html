<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.4eaa0d2ab01252bb1f85.css">@import url(https://fonts.googleapis.com/css2?family=Forum&display=swap);
/*! bettertext.css v2.0.4 | MIT License | github.com/paulradzkov/bettertext.css */body,h1,h2,h3,h4,h5,h6{font-family:sans-serif}body,h5{line-height:1.5}b,dl:not([class]) dt:not([class]),dt,h1,h2,h3,h4,h5,h6,strong{font-weight:bolder}abbr,h6{letter-spacing:.05em}body{font-size:1em}article:not([class]),body:not([class]),section:not([class]){margin:calc(24px + 4vh) calc(10px + 4vw)}article:not([class]) article:not([class]),article:not([class]) section:not([class]),body:not([class]) article:not([class]),body:not([class]) section:not([class]),section:not([class]) article:not([class]),section:not([class]) section:not([class]){margin-left:0;margin-right:0}p{margin:0 0 1.5em;max-width:50rem}ol:not([class]):before,p:before,ul:not([class]):before{content:"";display:block;width:10em;overflow:hidden}li p:before{content:none}h1{font-size:1.625em;line-height:1.1;margin:3.23076923em 0 .92307692em}h2{font-size:1.4375em;line-height:1.2;margin:3.13043478em 0 1.04347826em}h3{font-size:1.25em;line-height:1.3;margin:3em 0 1.2em}h4{font-size:1.125em;line-height:1.4;margin:2.66666667em 0 1.33333333em}h5{font-size:1em;margin:2.25em 0 1.5em}h6{font-size:.75em;line-height:2;margin:2em 0 0;text-transform:uppercase}@media (min-width:768px){h1{font-size:2.4375em;margin-top:3.07692308em;margin-bottom:.61538462em}h2{font-size:1.9375em;margin-top:3.09677419em;margin-bottom:.77419355em}h3{font-size:1.5625em;margin-top:2.88em;margin-bottom:.96em}h4{font-size:1.25em;margin-top:2.4em;margin-bottom:1.2em}}h1:first-child,h2:first-child,h3:first-child,h4:first-child,h5:first-child,h6:first-child{margin-top:0}h1+h2{margin-top:1.2em}h2+h3{margin-top:1.3em}h3+h4{margin-top:1.4em}h4+h5{margin-top:1.5em}h5+h6{margin-top:2em}ol:not([class]),ul:not([class]){margin:0 0 1.5em;max-width:47.5rem;padding-left:0;padding-right:2.5em}blockquote>p:last-child,ol:not([class]) ol,ol:not([class]) ul,ul:not([class]) ol,ul:not([class]) ul{margin-bottom:0}ol:not([class]) li,ul:not([class]) li{transform:translateX(2.5em);animation:fixlists 1s}@keyframes fixlists{0%{text-indent:-.001em}to{text-indent:0}}img{max-width:100%;height:auto;vertical-align:bottom}p img:not(:only-child){vertical-align:baseline}figure:not([class]){margin:3em 0}figure:not([class])>p{max-width:37.5rem;font-size:.75em;margin:.5em 0 0}dl:not([class]),hr:not([class]){max-width:50rem}figcaption{max-width:37.5rem;font-size:.75em;margin:.5em 0 3em}figcaption>p{margin:.5em 0 0}blockquote,dl:not([class]),dl:not([class]) dd:not([class]){margin:0 0 1.5em}blockquote{max-width:45rem;padding:1.5em 2.5em}blockquote>cite,blockquote>footer{display:block;font-size:.75em}pre{margin:1.5em 0;white-space:pre-wrap}p code{line-break:loose;overflow-wrap:break-word}table:not([class]){margin-top:3em;margin-bottom:3em;border-collapse:separate;border-spacing:0}table:not([class]) caption{text-align:left;font-size:.75em;margin-bottom:.625em}table:not([class]) td,table:not([class]) th{padding:.5em 1em;text-align:left;vertical-align:top;border:solid rgba(0,0,0,.1);border-width:0 0 1px}table:not([class]) thead td,table:not([class]) thead th{vertical-align:bottom;border-bottom-width:2px}hr:not([class]){border:0;border-bottom:1px solid;margin:1.5em 0;opacity:.1}abbr{margin-right:-.05em}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}body{overflow-x:hidden}article{-webkit-columns:2;column-count:2}.tree-on-box{height:450px;position:absolute;left:-120px;bottom:-195px;z-index:-1}p.screen{display:inline-block;width:70%;margin:0 15% 24px}.compare{position:relative}.compare canvas{position:absolute;top:calc(50% - 75px);left:calc(50% - 50px)}.lead{margin:calc(-24px - 4vh) calc(-10px - 4vw) auto;height:75vmin;overflow:hidden;position:relative}.lead .gatsby-image-wrapper{position:absolute!important;overflow:hidden;height:75vmin;bottom:0;left:0;right:0;z-index:0;-webkit-filter:brightness(.65);filter:brightness(.65)}.lead h1{z-index:1;color:#fff;font-size:50vmin;margin:0;line-height:1.25;font-family:Forum,cursive}.lead h1,.lead summary{position:relative;text-align:center;font-weight:100}.lead summary{color:wheat;width:80vmin;margin:auto;font-size:2rem}@media screen and (max-width:768px){article{-webkit-columns:1;column-count:1}}@media screen and (max-width:375px){.lead h1{font-size:40vmin}.lead summary{font-size:1.2rem}}</style><meta name="generator" content="Gatsby 2.23.6"/><title data-react-helmet="true">О процедурной генерации лесов | Истории о разработке Webgl сцен</title><meta data-react-helmet="true" name="description" content="Это истории о том, как разработывать Webgl сцены для собственного удовольстия, без претензии на экспертизу"/><meta data-react-helmet="true" property="og:title" content="О процедурной генерации лесов"/><meta data-react-helmet="true" property="og:description" content="Это истории о том, как разработывать Webgl сцены для собственного удовольстия, без претензии на экспертизу"/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="@johnSamilin"/><meta data-react-helmet="true" name="twitter:title" content="О процедурной генерации лесов"/><meta data-react-helmet="true" name="twitter:description" content="Это истории о том, как разработывать Webgl сцены для собственного удовольстия, без претензии на экспертизу"/><link rel="icon" href="/favicon-32x32.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="theme-color" content="#663399"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=4a9773549091c227cd2eb82ccd9c5e3a"/><link as="script" rel="preload" href="/webpack-runtime-ce49a7f4025aeaf6bfbc.js"/><link as="script" rel="preload" href="/framework-5fc6169171e885c3b522.js"/><link as="script" rel="preload" href="/app-9e65ea8fe1cb13b00c28.js"/><link as="script" rel="preload" href="/styles-c2fe8482057191dca484.js"/><link as="script" rel="preload" href="/commons-0386d1ed825b7da1d51b.js"/><link as="script" rel="preload" href="/component---src-pages-index-js-d3b9a262384a0c868d5d.js"/><link as="fetch" rel="preload" href="/page-data\index\page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data\app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><main><div class="lead"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden"><div aria-hidden="true" style="width:100%;padding-bottom:62.5%"></div><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAANABQDAREAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAABgQJ/8QAGgEAAQUBAAAAAAAAAAAAAAAABwECAwQFBv/aAAwDAQACEAMQAAABzwExJWSZ5m205Fgsl7eqmOP/xAAbEAACAgMBAAAAAAAAAAAAAAADBAECBQYUEv/aAAgBAQABBQLwLlJcBEC5BQcobKxJrZEMrcqzlP/EACQRAAICAQMEAgMAAAAAAAAAAAECAwQRBRIhABMiMTJBFFFh/9oACAEDAQE/AbzrY1XQQsgEZ0qCN2YplJfy3Ocjg43gckkj3yOtdigmvSMvprt8BhwuyCOpCm7HHlj7++tRrQtZ4tdrFaiuI8YbbSrruOVY7uMH169dV9OeXuNDcmrdphjtgMw8sjY7eUZHHx/v76hp1RRBswi407zSB5Th49rFMKy8kuVEjn0W+KLzm1qM1G3aqy4ttFO4Ez+DFOCqkDf8B4g7vQHX/8QAJBEAAgICAgICAgMAAAAAAAAAAQIDEQQSEyEAMQUyFFFhgpH/2gAIAQIBAT8BjaU5nybHaLkwsvRdmVY3xiGk2cddpPQogN0VHifkQz4cVNdSybEWQ44OQ7de43YL7JcX6A8XAne5QHHLT3X2pFjv/Iwv9fMn4CCNcvjnmjto9hH0G6XWydpLX979/wAUPMbBkrR8ydw5F2bIpnjBjZmZonKUHZGG5FkegDnZGMz48k08/E2qPy8dRsBIqahD9NyoN2RV+f/EACYQAAIBAwMEAQUAAAAAAAAAAAECAwQREhMhIgAFMUEUFSQzUYH/2gAIAQEABj8C7Qi4zadbSZmyO0i1UhWIKhF7q1MSbqSNw/XcljaPCU0kL+uK/PMahQTZM8dQtuFOI87rBw+3XSsN7XZpSDf3eQn+9URemglKiVUaS5Zd2LkAWj5ehp8f2ST1PP8ATqUSBHeNlBTAogl5CPBZk1AbJKrBVNvPIx1UVLS02sl5IxCZbyIzRNJk0i/k0wxW1gfHX//EABkQAQEBAQEBAAAAAAAAAAAAAAERIQAxQf/aAAgBAQABPyHykj8vEwQ2qRHj9RdhWOpT4nq8UB9hKoDekmQfb1VRBKjAZ4AtqMHxesQIiUQ9k2+jCnQF/AEAApMd/9oADAMBAAIAAwAAABC1dX//xAAYEQEBAQEBAAAAAAAAAAAAAAABETEAIf/aAAgBAwEBPxA9AIQHORjdAJXnNN2AuUU1IloGoJQGyB4ikoqfMJFgTggiqdUFdooVGx9+rkARjhCXgMlPrENUKISkc7//xAAaEQEBAQEAAwAAAAAAAAAAAAABESEAMUFx/9oACAECAQE/EJEs3TDwg+RjGgkS26NgBDAEQYiLqNqtlkHAAPr30rkbgsLfglvkIQFAtFxMALEaiB3emskNABUoKAtd/8QAGBABAQEBAQAAAAAAAAAAAAAAAREhADH/2gAIAQEAAT8QuRSdkO7vdRmWruJVpJvYYSPMmx+KwOT2RrGoYbCLcCRKo3MARQ4xzX2pFkbpG5224PmMbFrv/9k=" alt="" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/static/b0c64fef2c42484dd50c89fdafa4c209/836e2/les-krasivye-kartinki-na-rabochij-stol-2.jpg 480w,
/static/b0c64fef2c42484dd50c89fdafa4c209/b1cc5/les-krasivye-kartinki-na-rabochij-stol-2.jpg 960w,
/static/b0c64fef2c42484dd50c89fdafa4c209/d895d/les-krasivye-kartinki-na-rabochij-stol-2.jpg 1843w" sizes="(max-width: 1843px) 100vw, 1843px" /><img loading="lazy" sizes="(max-width: 1843px) 100vw, 1843px" srcset="/static/b0c64fef2c42484dd50c89fdafa4c209/836e2/les-krasivye-kartinki-na-rabochij-stol-2.jpg 480w,
/static/b0c64fef2c42484dd50c89fdafa4c209/b1cc5/les-krasivye-kartinki-na-rabochij-stol-2.jpg 960w,
/static/b0c64fef2c42484dd50c89fdafa4c209/d895d/les-krasivye-kartinki-na-rabochij-stol-2.jpg 1843w" src="/static/b0c64fef2c42484dd50c89fdafa4c209/d895d/les-krasivye-kartinki-na-rabochij-stol-2.jpg" alt="" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><h1>Лес</h1><summary>Это история о том, как вырастить лес. В браузере.</summary></div><article><iframe class="tree-on-box" frameBorder="0" src="/tree-on-cube/index.html"></iframe><p>Предположим, вы хотите создать игру, действие которой происходит в лесу. Или же просто игру, в которой есть лесной массив. Как это сделать? Самый дешевый способ - сгенерировать случайное распределение деревьев по заданной поверхности.</p><p>Однажды, когда я был за городом, я много времени провел в лесу и мне не давала покоя мысль: как сымитировать его случайность? В лесу все хаотично, но при этом взаимосвязано. Тогда я провел небольше исследование и нашел отличную статью Уэсли Керра<!-- --> <a href="https://www.wesley-kerr.com/forest/">о генерации лесов</a>. Я не буду делать перевод этой статьи, однако, она довольно простая и интересная, и она точно стоит того, чтобы ознакомиться. Или, например, с этими работами по<!-- --> <a href="http://pcg.wikidot.com/pcg-algorithm:forests">процедурной генерации растений</a>. Основываясь на этой работе я сделал порт кода в javascript и вот что из этого вышло. Результат можно увидеть в<!-- --> <a href="https://github.com/johnSamilin/forest/blob/develop/src/utils/ForestGenerator.ts">репозитории</a>.</p><h2>Камера, мотор</h2><p>Представим, что у нас есть уже настроенная сцена на<!-- --> <em>react-three-fiber</em>: равнина, которую предстоит засеять деревьями, камера и свет.</p><p>Как следует из статьи, работа алгоритма имитации леса зависит от параметров:<ul><li>n<sub>f</sub> - начальное количество деревьев.</li><li>R<sub>s</sub> - радиус, внутри которого падают семена.</li><li>S<sub>s</sub> - количество семян, которые падают в каждой итерации.</li><li>d<sub>s</sub> - вероятность гибели семян.</li><li>F<sub>c</sub> - желаемый уровень покрытия поверхности лесом.</li></ul>Изначально разбрасываем по полю несколько деревьев (n<sub>f</sub>), затем повторяем этап роста столько раз, сколько потребуется для желаемого уровня покрытия. Каждый этап роста сопровождается:<ol><li>падением семян</li><li>ростом деревьем</li><li>гибелью семян :(</li></ol></p><p>Хорошо, алгоритм работает. И результатом его работы является матрица с числами от 1 до 3 и массив координат, на которых должны располагаться деревья. Зачем нам матрица, спросите вы. Затем, что она показывает проходимые (пусто) и непроходимые (дерево) области, а мы хотим знать<!-- --> <del>где сидит фазан</del> это, чтобы использовать в алгоритме поиска пути. Итак, что же получилось?</p><p class="screen"><img src="/images/trees-close.PNG"/></p><p>Выглядит не очень. Все потому, что трехмерные объекты обладают размерами и нужно с этим считаться. Предположим, что каждая ячейка<!-- --> <em>матрицы проходимости</em> представляет собой ячейку поверхности в сцене размером <strong>NxN</strong>. Тогда для того, чтобы получить реальные координаты дерева, нужно просто умножить их на N. Но все равно чего-то не хватает.</p><h2>Точки опоры</h2><p>Когда вы хотите расположить объект в трехмерной сцене в точке [0, 0, 0], где вы ожидаете его увидеть? Если это окно браузера, то, вероятно, в углу плоскости. <em>Нет</em>. Центр системы координат в такой сцене совпадает с центром плоскости, и для того, чтобы правильно разместить лес по поверхности, нужно вычесть из координат каждого дерева ¼ ширины или длины плоскости.</p><p>Теперь у нас две проблемы. Во-первых, деревья расположены так, как должны, за одним исключением. Часть из них, те, что растут густо, выстроились в ровные ряды, как будто их сажали юннаты. Во-вторых, все они одного возраста и роста. За возраст можно взять то количество циклов генерации, которое &quot;прожило&quot; дерево. От него может зависеть его рост и количество падающих семян (S<sub>s</sub>). Это не совсем то, чего ожидаешь от дикой природы, так что давайте добавим в<!-- --> <em>случайное распределение</em> элемент случайности.</p><div class="compare"><p class="screen"><img src="/images/trees-translated.PNG"/></p><canvas width="110" height="160"></canvas><p class="screen"><img src="/images/trees-final.PNG"/></p></div><p>И получим вполне реалистичный лес.</p></article></main></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-9e65ea8fe1cb13b00c28.js"],"component---src-pages-404-js":["/component---src-pages-404-js-852bd3a5faea7629c57d.js"],"component---src-pages-index-js":["/component---src-pages-index-js-d3b9a262384a0c868d5d.js"],"component---src-pages-page-2-js":["/component---src-pages-page-2-js-cca7f5da347581a7e881.js"],"component---src-pages-using-typescript-tsx":["/component---src-pages-using-typescript-tsx-ccc63956d1d6da3ec2a1.js"]};/*]]>*/</script><script src="/component---src-pages-index-js-d3b9a262384a0c868d5d.js" async=""></script><script src="/commons-0386d1ed825b7da1d51b.js" async=""></script><script src="/styles-c2fe8482057191dca484.js" async=""></script><script src="/app-9e65ea8fe1cb13b00c28.js" async=""></script><script src="/framework-5fc6169171e885c3b522.js" async=""></script><script src="/webpack-runtime-ce49a7f4025aeaf6bfbc.js" async=""></script></body></html>